!function(e,s){"object"==typeof exports&&"undefined"!=typeof module?module.exports=s(require("cross-fetch/polyfill"),require("js-base64"),require("sip.js"),require("reconnecting-websocket")):"function"==typeof define&&define.amd?define(["cross-fetch/polyfill","js-base64","sip.js","reconnecting-websocket"],s):e["@wazo/sdk"]=s(null,e.jsBase64,e.SIP,e.ReconnectingWebSocket)}(this,function(e,s,t,n){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,n=n&&n.hasOwnProperty("default")?n.default:n;class r{static fromResponse(e){return new r(e.message,e.timestamp,e.error_id,e.details)}static fromText(e){return new r(e)}constructor(e,s=null,t=null,n=null){this.message=e,this.timestamp=s,this.errorId=t,this.details=n}}class i{static hasDebug(){return"undefined"!=typeof process&&(1==+process.env.DEBUG||"true"===process.env.DEBUG)}static logRequest(e,{method:s,body:t,headers:n},r){if(!i.hasDebug())return;const{status:a}=r;let o=`${a} - curl ${"get"!==s?`-X ${s.toUpperCase()}`:""}`;Object.keys(n).forEach(e=>{o+=` -H '${e}: ${n[e]}'`}),o+=` ${e}`,t&&(o+=` -d '${t}'`),console.info(o)}}const a=["head","get","post","put","delete"];class o{static successResponseParser(e,s){return 204===e.status}static parseBadResponse(e){return s=>s instanceof r?s:e(s)}static defaultParser(e,s){return e.ok?e.json().then(e=>e):(s?e.json():e.text()).then(e=>s?r.fromResponse(e):r.fromText(e))}static getHeaders(e){return e instanceof Object?e:{"X-Auth-Token":e,Accept:"application/json","Content-Type":"application/json"}}static getQueryString(e){return Object.keys(e).filter(s=>e[s]).map(s=>`${s}=${encodeURIComponent(e[s])}`).join("&")}static base64Encode(e){return"undefined"!=typeof btoa?btoa(e):s.Base64.encode(e)}constructor({server:e,agent:s=null}){this.server=e,this.agent=s,a.forEach(e=>{o.prototype[e]=function(...s){return s.splice(1,0,e),this.call.call(this,...s)}})}call(e,s="get",t=null,n=null,r=o.defaultParser){const a=this.computeUrl(s,e,t),l=t&&"get"!==s?JSON.stringify(t):null,u="delete"===s||"head"===s?o.successResponseParser:r,c={method:s,body:l,headers:n?o.getHeaders(n):{},agent:this.agent};return fetch(a,c).then(e=>{const s=-1!==(e.headers.get("content-type")||"").indexOf("application/json");if(i.logRequest(a,c,e),e.status>=500){return(s?e.json():e.text()).then(e=>{throw e})}return u(e,s)})}computeUrl(e,s,t){const n=`${this.baseUrl}/${s}`;return"get"===e&&t&&Object.keys(t).length?`${n}?${o.getQueryString(t)}`:n}get baseUrl(){return`https://${this.server}/api`}}class l{static parse(e){return new l({id:e.id,extensions:e.extensions})}constructor({id:e,extensions:s}){this.id=e,this.extensions=s}}const u={BUSY:"busy",NO_ANSWER:"noanswer",UNCONDITIONAL:"unconditional"};class c{static parse(e,s){return new c({destination:e.destination||"",enabled:e.enabled,key:s})}constructor({destination:e,enabled:s,key:t}){this.destination=e,this.enabled=s,this.key=t}setDestination(e){return this.destination=e,this}is(e){return this.key===e.key}}class d{static parse(e){return new d({id:e.uuid,firstName:e.firstName,lastName:e.lastName,email:e.email,lines:e.lines.map(e=>l.parse(e)),username:e.username,mobileNumber:e.mobile_phone_number||"",forwards:[c.parse(e.forwards.unconditional,u.UNCONDITIONAL),c.parse(e.forwards.noanswer,u.NO_ANSWER),c.parse(e.forwards.busy,u.BUSY)],doNotDisturb:e.services.dnd.enabled})}constructor({id:e,firstName:s,lastName:t,email:n,lines:r,username:i,mobileNumber:a,forwards:o,doNotDisturb:l,presence:u}){this.id=e,this.firstName=s,this.lastName=t,this.email=n,this.lines=r,this.username=i,this.mobileNumber=a,this.forwards=o,this.doNotDisturb=l,this.presence=u}hasId(e){return e===this.id}setMobileNumber(e){return this.mobileNumber=e,this}setForwardOption(e){const s=this.forwards.slice(),t=s.findIndex(s=>s.is(e));return s.splice(t,1,e),this.forwards=s,this}setDoNotDisturb(e){return this.doNotDisturb=e,this}setPresence(e){return this.presence=e,this}}class h{static merge(e,s){return s.map(s=>{const t=e.find(e=>e.is(s));return void 0!==t?s.merge(t):s})}static parseMany(e){return e.results.map(s=>h.parse(s,e.column_types))}static parse(e,s){return new h({name:e.column_values[s.indexOf("name")],number:e.column_values[s.indexOf("number")]||"",favorited:e.column_values[s.indexOf("favorite")],email:e.column_values[s.indexOf("email")]||"",entreprise:e.column_values[s.indexOf("entreprise")]||"",birthday:e.column_values[s.indexOf("birthday")]||"",address:e.column_values[s.indexOf("address")]||"",note:e.column_values[s.indexOf("note")]||"",endpointId:e.relations.endpoint_id,personal:e.column_values[s.indexOf("personal")],source:e.source,sourceId:+e.relations.source_entry_id,uuid:e.relations.user_uuid})}static parseManyPersonal(e){return e.map(e=>h.parsePersonal(e))}static parsePersonal(e){return new h({name:`${e.firstName||e.firstname||""} ${e.lastName||e.lastname||""}`,number:e.number||"",email:e.email||"",source:"personal",sourceId:e.id,entreprise:e.entreprise||"",birthday:e.birthday||"",address:e.address||"",note:e.note||"",favorited:!1,personal:!0})}constructor({id:e,uuid:s,name:t,number:n,email:r,source:i,sourceId:a,entreprise:o,birthday:l,address:u,note:c,presence:d,status:h,endpointId:p,personal:m}){this.id=e,this.uuid=s,this.name=t,this.number=n,this.email=r,this.source=i,this.sourceId=a,this.entreprise=o,this.birthday=l,this.address=u,this.note=c,this.presence=d,this.status=h,this.endpointId=p,this.personal=m}setFavorite(e){this.favorited=e}is(e){return Boolean(e)&&this.sourceId===e.sourceId&&(!this.uuid||this.uuid===e.uuid)}hasId(e){return this.uuid===e}hasNumber(e){return this.number===e}hasEndpointId(e){return this.endpointId===e}isAvailable(){return"available"===this.presence}isDoNotDisturb(){return"donotdisturb"===this.presence}isDisconnected(){return"disconnected"===this.presence}merge(e){return this.presence=e.presence,this.status=e.status,this}isIntern(){return!!this.uuid}isCallable(e){return!!this.number&&!!e&&!e.is(this)}separateName(){if(!this.name)return{firstName:"",lastName:""};const e=this.name.split(" ");return{firstName:e[0],lastName:e.slice(1).join(" ")}}}class p{static parse(e){return new p({token:e.data.token,uuid:e.data.xivo_user_uuid})}constructor({token:e,uuid:s,profile:t}){this.token=e,this.uuid=s,this.profile=t}is(e){return Boolean(e)&&this.uuid===e.uuid}using(e){return this.profile=e,this}displayName(){return this.profile?`${this.profile.firstName} ${this.profile.lastName}`:""}primaryLine(){return this.profile?this.profile.lines[0]:null}primaryContext(){const e=this.primaryLine();return e?e.extensions[0].context:null}primaryNumber(){const e=this.primaryLine();return e?e.extensions[0].exten:null}}var m=(e,s)=>({checkToken:t=>e.head(`${s}/token/${t}`,null,{}),authenticate:t=>e.get(`${s}/token/${t}`,null,{}).then(o.parseBadResponse(e=>p.parse(e))),logIn(t={}){const n={backend:t.backend||"wazo_user",expiration:t.expiration||3600},r={Authorization:`Basic ${o.base64Encode(`${t.username}:${t.password}`)}`,"Content-Type":"application/json"};return e.post(`${s}/token`,n,r).then(o.parseBadResponse(e=>p.parse(e)))},logOut:t=>e.delete(`${s}/token/${t}`,null,{},o.successResponseParser),updatePassword(t,n,r,i){const a={new_password:i,old_password:r};return e.put(`${s}/users/${n}/password`,a,t,o.successResponseParser)},sendDeviceToken(t,n,r){const i={token:r};return e.post(`${s}/users/${n}/external/mobile`,i,t)},removeDeviceToken:(t,n)=>e.delete(`${s}/users/${n}/external/mobile`,null,t),getUser:(t,n)=>e.get(`${s}/users/${n}`,null,t),listTenants:t=>e.get(`${s}/tenants`,null,t),getTenant:(t,n)=>e.get(`${s}/tenants/${n}`,null,t),createTenant:(t,n)=>e.post(`${s}/tenants`,{name:n},t),deleteTenant:(t,n)=>e.delete(`${s}/tenants/${n}`,null,t),listUsers:t=>e.get(`${s}/users`,"get",null,t),listGroups:t=>e.get(`${s}/groups`,null,t),listPolicies:t=>e.get(`${s}/policies`,null,t)}),g=(e,s)=>({answerCall(t,n,r,i,a,o){const l=`${s}/${n}/nodes`,u={calls:[{id:r}]};return e.post(l,u,t,e=>e.data.uuid).then(s=>e.post(`${l}/${s}/calls`,{context:i,exten:a,autoanswer:o},t).then(e=>({nodeUuid:s,data:e})))},calls:(t,n)=>e.get(`${s}/${n}/calls`,null,t),hangupCall(t,n,r){const i=`${s}/${n}/calls/${r}`;return e.delete(i,"delete",null,t)},playCall:(t,n,r,i,a)=>e.post(`${s}/${n}/calls/${r}/play`,{language:i,uri:a},t),addCallNodes:(t,n,r,i)=>e.put(`${s}/${n}/nodes/${r}/calls/${i}`,null,t),addNewCallNodes(t,n,r,i,a,o){const l={context:i,exten:a,autoanswer:o};return e.post(`${s}/${n}/nodes/${r}/calls`,l,t)},listCallsNodes:(t,n,r)=>e.get(`${s}/${n}/nodes/${r}`,null,t),listNodes:(t,n)=>e.get(`${s}/${n}/nodes`,null,t),removeNode:(t,n,r)=>e.delete(`${s}/${n}/nodes/${r}`,null,t),removeCallNodes:(t,n,r,i)=>e.delete(`${s}/${n}/nodes/${r}/calls/${i}`,"delete",null,t)}),b=(e,s)=>({listUsers:t=>e.get(`${s}/users`,null,t),getUser:(t,n)=>e.get(`${s}/users/${n}`,null,t),updateUser(t,n,r){const i={firstname:r.firstName,lastname:r.lastName,email:r.email,mobile_phone_number:r.mobileNumber};return e.put(`${s}/users/${n}`,i,t,o.successResponseParser)},updateForwardOption(t,n,r,i,a){const l=`${s}/users/${n}/forwards/${r}`;return e.put(l,{destination:i,enabled:a},t,o.successResponseParser)},updateDoNotDisturb(t,n,r){const i=`${s}/users/${n}/services/dnd`;return e.put(i,{enabled:r},t,o.successResponseParser)},getUserLineSip:(t,n,r)=>e.get(`${s}/users/${n}/lines/${r}/associated/endpoints/sip`,null,t),listApplications(t){const n=`${s}/applications?recurse=true`;return e.get(n,null,t)},getSIP:(t,n,r)=>e.get(`${s}/users/${n}/lines/${r}/associated/endpoints/sip`,null,t)}),f=(e,s)=>({listSubscriptions:t=>e.get(`${s}/subscriptions?recurse=true`,null,t),createSubscription(t,{tenantUuid:n,productSku:r,name:i,startDate:a,contractDate:o,autoRenew:l,term:u}){const c={product_sku:r,name:i,start_date:a,contract_date:o,auto_renew:l,term:u},d={"X-Auth-Token":t};return n&&(d["Wazo-Tenant"]=n),e.post(`${s}/subscriptions`,c,d)},getSubscription:(t,n)=>e.get(`${s}/subscriptions/${n}`,null,t),listAuthorizations:(t,n)=>e.get(`${s}/subscriptions/${n}/authorizations`,null,t),getAuthorization:(t,n,r)=>e.get(`${s}/subscriptions/${n}/authorizations/${r}`,null,t),createAuthorization(t,n,{startDate:r,term:i,service:a,rules:o,autoRenew:l}){const u=`${s}/subscriptions/${n}/authorizations`,c={start_date:r,term:i,service:a,rules:o,auto_renew:l};return e.post(u,c,t)}});const $=()=>{const e=()=>Math.floor(65536*(1+Math.random())).toString(16).substring(1);return`${e()}${e()}-${e()}-${e()}-${e()}-${e()}${e()}${e()}`};class w{static parseMany(e){return e.items.map(e=>w.parse(e))}static parse(e){return new w({id:$(),date:new Date(e.date),message:e.msg,direction:e.direction,destination:{serverId:e.destination_server_uuid,userId:e.destination_user_uuid},source:{serverId:e.source_server_uuid,userId:e.source_user_uuid},read:!0})}static parseMessageSent(e){return new w({id:$(),date:new Date,message:e.msg,direction:"sent",destination:{serverId:e.to[0],userId:e.to[1]},source:{serverId:e.from[0],userId:e.from[1]},read:!0})}static parseMessageReceived(e){return new w({id:$(),date:new Date,message:e.msg,direction:"received",destination:{serverId:e.to[0],userId:e.to[1]},source:{serverId:e.from[0],userId:e.from[1]},read:!1})}constructor({id:e,date:s,message:t,direction:n,destination:r,source:i,read:a=!0}){this.id=e,this.date=s,this.message=t,this.direction=n,this.destination=r,this.source=i,this.read=a}is(e){return this.id===e.id}isIncoming(){return"received"===this.direction}acknowledge(){this.read=!0}getTheOtherParty(){return"sent"===this.direction?this.destination.userId:this.source.userId}}class N{static parse(e){return new N({id:e.id,date:new Date(e.timestamp),duration:1e3*e.duration,caller:{name:e.caller_id_name,number:e.caller_id_num},unread:e.folder?"new"===e.folder.type:null})}static parseMany(e){const s=e.folders.filter(e=>"new"===e.type)[0].messages,t=e.folders.filter(e=>"old"===e.type)[0].messages;return[...s.map(e=>N.parse(e)).map(e=>e.makeAsUnRead()),...t.map(e=>N.parse(e)).map(e=>e.acknowledge())]}constructor({id:e,date:s,duration:t,caller:n}){this.id=e,this.date=s,this.duration=t,this.caller=n}is(e){return e&&this.id===e.id}acknowledge(){return this.unread=!1,this}makeAsUnRead(){return this.unread=!0,this}contains(e){return!e||(this.caller.name.toUpperCase().includes(e.toUpperCase())||this.caller.number.includes(e))}}class v{static parseMany(e){return e.map(e=>v.parse(e))}static parse(e){return new v({id:+e.call_id,calleeName:e.peer_caller_id_name,calleeNumber:e.peer_caller_id_number,status:e.status,startingTime:new Date(e.creation_time)})}constructor({id:e,calleeName:s,calleeNumber:t,status:n,startingTime:r}){this.id=e,this.calleeName=s,this.calleeNumber=t,this.status=n,this.startingTime=r}separateCalleeName(){const e=this.calleeName.split(" ");return{firstName:e[0],lastName:e.slice(1).join(" ")}}is(e){return this.id===e.id}hasACalleeName(){return this.calleeName.length>0}isUp(){return"Up"===this.status}isDown(){return"Down"===this.status}isRingingIncoming(){return"Ringing"===this.status}isRingingOutgoing(){return"Ring"===this.status}isFromTransfer(){return"Down"===this.status||"Ringing"===this.status}}var y=(e,s)=>({updatePresence:(t,n)=>e.put(`${s}/users/me/presences`,{presence:n},t,o.successResponseParser),listMessages(t,n){const r=n?{participant_user_uuid:n}:null;return e.get(`${s}/users/me/chats`,r,t).then(o.parseBadResponse(e=>w.parseMany(e)))},sendMessage(t,n,r,i){const a={alias:n,message:r,to:i};return e.post(`${s}/users/me/chats`,a,t)},makeCall:(t,n)=>e.post(`${s}/users/me/calls`,{from_mobile:!0,extension:n},t),cancelCall:(t,n)=>e.delete(`${s}/users/me/calls/${n}`,null,t),listCalls:t=>e.get(`${s}/users/me/calls`,null,t).then(o.parseBadResponse(e=>v.parseMany(e.items))),relocateCall(t,n,r,i){const a={completions:["answer"],destination:r,initiator_call:n};return i&&(a.location={line_id:i}),e.post(`${s}/users/me/relocates`,a,t)},listVoicemails:t=>e.get(`${s}/users/me/voicemails`,null,t).then(o.parseBadResponse(e=>N.parseMany(e))),deleteVoicemail:(t,n)=>e.delete(`${s}/users/me/voicemails/messages/${n}`,null,t),getPresence:(t,n)=>e.get(`${s}/users/${n}/presences`,null,t),getStatus:(t,n)=>e.get(`${s}/lines/${n}/presences`,null,t)});const D=e=>({email:e.email,firstname:e.firstName?e.firstName:null,lastname:e.lastName?e.lastName:null,number:e.phoneNumber?e.phoneNumber:null,entreprise:e.entreprise,birthday:e.birthday,address:e.address,note:e.note});var k=(e,s)=>({search:(t,n,r)=>e.get(`${s}/directories/lookup/${n}`,{term:r},t).then(o.parseBadResponse(e=>h.parseMany(e))),listPersonalContacts:t=>e.get(`${s}/personal`,null,t).then(o.parseBadResponse(e=>h.parseManyPersonal(e))),addContact:(t,n)=>e.post(`${s}/personal`,D(n),t).then(o.parseBadResponse(e=>h.parsePersonal(e))),editContact:(t,n)=>e.put(`${s}/personal/${n.id||""}`,D(n),t),deleteContact:(t,n)=>e.delete(`${s}/personal/${n}`,null,t),listFavorites:(t,n)=>e.get(`${s}/directories/favorites/${n}`,null,t).then(o.parseBadResponse(e=>h.parseMany(e))),markAsFavorite(t,n,r){const i=`${s}/directories/favorites/${n}/${r}`;return e.put(i,"put",null,t,o.successResponseParser)},removeFavorite:(t,n,r)=>e.delete(`${s}/directories/favorites/${n}/${r}`,null,t)});class _{static merge(e,s){const t=e.concat(s);return t.map(e=>e.id).filter((e,s,t)=>t.indexOf(e)===s).map(e=>t.find(s=>s.id===e))}static parseMany(e){return e.items.map(e=>_.parse(e))}static parse(e){return new _({answer:new Date(e.answer),answered:e.answered,callDirection:e.call_direction,destination:{extension:e.destination_extension,name:e.destination_name||""},source:{extension:e.source_extension,name:e.source_name},id:e.id,duration:1e3*(e.duration||0),start:new Date(e.start),end:new Date(e.end)})}static parseNew(e,s){return new _({answer:new Date(e.answer),answered:e.answered,callDirection:e.call_direction,destination:{extension:e.destination_extension,name:e.destination_name||""},source:{extension:e.source_extension,name:e.source_name},id:e.id,duration:1e3*(e.duration||0),start:new Date(e.start),end:new Date(e.end),newMissedCall:e.destination_extension===s.primaryNumber()&&!e.answered})}constructor({answer:e,answered:s,callDirection:t,destination:n,source:r,id:i,duration:a,start:o,end:l}){this.answer=e,this.answered=s,this.callDirection=t,this.destination=n,this.source=r,this.id=i,this.duration=a,this.start=o,this.end=l}isFromSameParty(e,s){return this.theOtherParty(s).extension===e.theOtherParty(s).extension}theOtherParty(e){return this.source.extension===e.primaryNumber()?this.destination:this.source}isNewMissedCall(){return this.newMissedCall}acknowledgeCall(){return this.newMissedCall=!1,this}isAcknowledged(){return this.newMissedCall}isAnOutgoingCall(e){return this.source.extension===e.primaryNumber()&&this.answered}isAMissedOutgoingCall(e){return this.source.extension===e.primaryNumber()&&!this.answered}isAnIncomingCall(e){return this.destination.extension===e.primaryNumber()&&this.answered}isADeclinedCall(e){return this.destination.extension===e.primaryNumber()&&!this.answered}}var C=(e,s)=>({search:(t,n,r=5)=>e.get(`${s}/users/me/cdr`,{search:n,limit:r},t).then(o.parseBadResponse(e=>_.parseMany(e))),listCallLogs:(t,n,r=5)=>e.get(`${s}/users/me/cdr`,{offset:n,limit:r},t).then(o.parseBadResponse(e=>_.parseMany(e))),listCallLogsFromDate:(t,n,r)=>e.get(`${s}/users/me/cdr`,{from:n,number:r},t).then(o.parseBadResponse(e=>_.parseMany(e)))});const P="0.1",x="1.0",S="1.1",I="1.0",R="1.0",O="0.1",A="1.0";class T{constructor(){this.callbacks={}}on(e,s){this.callbacks[e]=s}triggerCallback(e,...s){return s.push(e),this.callbacks["*"]?this.callbacks["*"].apply(void 0,s):e in this.callbacks?this.callbacks[e].apply(void 0,s):null}}const U=["STATUS_NULL","STATUS_NEW","STATUS_CONNECTING","STATUS_CONNECTED","STATUS_COMPLETED"],M=["registered","unregistered","new","ringing","connecting","connected","ended","hold","unhold","mute","unmute","dtmf","message"],E=e=>({caller_id_name:e.remoteIdentity.displayName,caller_id_number:e.remoteIdentity.uri.user}),B=e=>!!e.getHeader("alert-info"),j=/^\+?[0-9#*]+$/;class z{static parse(e){return new z(e?{sound:e.sound,vibration:e.vibration}:{sound:!0,vibration:!0})}constructor({sound:e=!0,vibration:s=!0}){this.sound=e,this.vibration=s}setSound(e){return this.sound=e,this}setVibration(e){return this.vibration=e,this}enable(){return this.vibration=!0,this.sound=!0,this}disable(){return this.vibration=!1,this.sound=!1,this}isEnabled(){return this.sound||this.vibration}}return{WazoApiClient:class{constructor({server:e,agent:s=null}){this.updatePatemers({server:e,agent:s})}initializeEndpoints(){this.auth=m(this.client,`auth/${P}`),this.application=g(this.client,`ctid-ng/${x}/applications`),this.confd=b(this.client,`confd/${S}`),this.accessd=f(this.client,`accessd/${I}`),this.ctidNg=y(this.client,`ctid-ng/${R}`),this.dird=k(this.client,`dird/${O}`),this.callLogd=C(this.client,`call-logd/${A}`)}updatePatemers({server:e,agent:s}){this.client=new o({server:e,agent:s}),this.initializeEndpoints()}},WazoWebRTCClient:class{constructor(e){this.config=e,this.userAgent=this.configureUserAgent(),this.callbacksHandler=new T}configureUserAgent(){const e=new t.Web.Simple(this.getConfig());return M.filter(e=>"new"!==e).forEach(s=>{e.on(s,e=>{this.callbacksHandler.triggerCallback(s,e)})}),e.on("new",e=>{this.callbacksHandler.triggerCallback("new",{callerid:E(e),autoanswer:B(e.request)})}),e}on(e,s){this.callbacksHandler.on(e,s)}getConfig(){const{media:{audio:e,video:s,localVideo:t}}=this.config;return{media:{remote:{audio:s||e,video:s},local:{video:t}},ua:{traceSip:!1,displayName:this.config.displayName,uri:this.config.uri,wsServers:this.config.wsServers,authorizationUser:this.config.authorizationUser,password:this.config.password,sessionDescriptionHandlerFactoryOptions:{peerConnectionOptions:{iceCheckingTimeout:500,rtcpMuxPolicy:"negotiate",rtcConfiguration:{iceServers:{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302"]}}}}}}}getState(){return U[this.userAgent.state]}call(e){j.exec(e)&&this.userAgent.call(e)}answer(){this.userAgent.answer()}reject(){this.userAgent.reject()}hangup(){this.userAgent.hangup()}close(){this.userAgent.transport.disconnect()}},WazoWebSocketClient:class{constructor({host:e,token:s,events:t=[]}){this.initialized=!1,this.callbacksHandler=new T,this.host=e,this.token=s,this.events=t}connect(){const e=new n(`wss://${this.host}/api/websocketd/?token=${this.token}`);return e.debug=!1,e.onmessage=(s=>{const t=JSON.parse("string"==typeof s.data?s.data:"{}");this.initialized?this.callbacksHandler.triggerCallback(t.name,t):this.handleMessage(t,e)}),e.onclose=(e=>{e.code}),e}on(e,s){this.callbacksHandler.on(e,s)}handleMessage(e,s){switch(e.op){case"init":this.events.forEach(e=>{const t={op:"subscribe",data:{event_name:e}};s.send(JSON.stringify(t))}),s.send(JSON.stringify({op:"start"}));break;case"subscribe":break;case"start":this.initialized=!0}}},BadResponse:r,Call:v,CallLog:_,ChatMessage:w,Contact:h,Country:{BELGIUM:"BE",CANADA:"CA",FRANCE:"FR",GERMANY:"DE",ITALY:"IT",PORTUGAL:"PT",SPAIN:"ES",SWITZERLAND:"CH",UNITED_KINGDOM:"GB",UNITED_STATES:"US"},ForwardOption:c,Line:l,NotificationOptions:z,Profile:d,Session:p,Voicemail:N,DebugPhone:class{makeCall(e){console.info("DebugPhone - calling: ${number}")}acceptCall(){console.info("DebugPhone - Accept call")}mute(){console.info("DebugPhone - Mute phone")}unmute(){console.info("DebugPhone - Unmute phone")}hold(){console.info("DebugPhone - Put on hold")}unhold(){console.info("DebugPhone - Put on unhold")}transfer(e){console.info(`DebugPhone - Transferring to ${e}`)}sendKey(e){console.info("DebugPhone - sending: ${key}")}putOnSpeaker(){console.info("DebugPhone - Put on speaker")}putOffSpeaker(){console.info("DebugPhone - Put off speaker")}endCall(){console.info("DebugPhone - Hang up")}onConnectionMade(){console.info("DebugPhone - Connection made")}close(){console.info("DebugPhone - Close")}},DebugDevice:class{connectToCall(){console.info("DebugDevice - Connected to call")}disconnectFromCall(){console.info("DebugDevice - Disconnected from call")}ringback(){console.info("DebugDevice - Ringback")}stopRingback(){console.info("DebugDevice - Stop ringback")}playRingtone(){console.info("DebugDevice - Play ringtone")}stopRingtone(){console.info("DebugDevice - Stop ringtone")}mute(){console.info("DebugDevice - Mute")}unmute(){console.info("DebugDevice - Unmute")}putOnSpeaker(){console.info("DebugDevice - Put on speaker")}putOffSpeaker(){console.info("DebugDevice - Put off speaker")}}}});
